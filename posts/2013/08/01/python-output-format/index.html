<!DOCTYPE html>
<html>
<head>
        <title>Python格式化输出 | H.B.Zhou's blog</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="http://localhost:8000/theme/css/bootstrap.min.css" type="text/css" />
        <link rel="stylesheet" href="http://localhost:8000/theme/css/bootstrap-responsive.min.css" type="text/css" />

        <link rel="stylesheet" href="http://localhost:8000/theme/css/main.css" type="text/css" />
                <link href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="H.B.Zhou's blog Atom Feed" />
                        <link href="http://localhost:8000/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="H.B.Zhou's blog RSS Feed" />
        </head>

<body id="index">
<a class="hidden-phone" href="http://github.com/tonyzhou/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" />
</a>
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="http://localhost:8000/">H.B.Zhou's blog </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                                                    <li><a href="index.html">Blog</a></li>
                                                    <li><a href="archives.html">Archives</a></li>
                                                                                                                                                </ul>

                                            </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
                <div class="span10">
                    <section  >
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://localhost:8000/posts/2013/08/01/python-output-format" rel="bookmark"
           title="Permalink to Python格式化输出">Python格式化输出</a></h1>
          </header>

    <div class="entry-content">
      <footer class="post-info">
        <address class="vcard author">
        by <a class="url fn" href="http://localhost:8000/author/tony-zhou.html">Tony Zhou</a>
    </address>
    
    in <a href="http://localhost:8000/category/python.html">Python</a>

    on 2013-08-01

            |
        tags:         <a href="http://localhost:8000/tag/publishing.html">publishing</a>
            
    
    
        
</footer><!-- /.post-info -->      <p>从2.6版本开始，Python引入了一种新的格式化输出字符串的方式：string.format，这种格式化方式和老的%tuple方式有所不同。 有了这个string.format，我们能更灵活的输出格式化字符串。</p>
<h2>string.format使用方式</h2>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span><span class="n">print</span> <span class="err">&#39;</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span> <span class="n">and</span> <span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="err">&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="err">&#39;</span><span class="n">spam</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">eggs</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">spam</span> <span class="n">and</span> <span class="n">eggs</span>
</pre></div>


<p>{0}和{1}在这里被称作replacement_field，replacement_field在输出时候会被替换成指定的参数，除了{number}，replacement_field还支持更加复杂的用法，它的详细语法格式如下：</p>
<div class="highlight"><pre><span class="n">replacement_field</span> <span class="o">::=</span>  <span class="s">&quot;{&quot;</span> <span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="p">[</span><span class="s">&quot;!&quot;</span> <span class="n">conversion</span><span class="p">]</span> <span class="p">[</span><span class="s">&quot;:&quot;</span> <span class="n">format_spec</span><span class="p">]</span> <span class="s">&quot;}&quot;</span>
<span class="n">field_name</span>        <span class="o">::=</span>  <span class="o">&lt;</span><span class="n">arg_name</span> <span class="p">(</span><span class="s">&quot;.&quot;</span> <span class="n">attribute_name</span> <span class="o">|</span> <span class="s">&quot;[&quot;</span> <span class="n">element_index</span> <span class="s">&quot;]&quot;</span><span class="p">)</span><span class="o">*</span>
<span class="n">arg_name</span>          <span class="o">::=</span>  <span class="p">[</span><span class="n">identifier</span> <span class="o">|</span> <span class="n">integer</span><span class="p">]</span>
<span class="n">attribute_name</span>    <span class="o">::=</span>  <span class="n">identifier</span>
<span class="n">element_index</span>     <span class="o">::=</span>  <span class="n">integer</span> <span class="o">|</span> <span class="n">index_string</span>
<span class="n">index_string</span>      <span class="o">::=</span>  <span class="o">&lt;</span><span class="n">any</span> <span class="n">source</span> <span class="n">character</span> <span class="n">except</span> <span class="s">&quot;]&quot;</span><span class="o">&gt;</span> <span class="o">+</span>
<span class="n">conversion</span>        <span class="o">::=</span>  <span class="s">&quot;r&quot;</span> <span class="o">|</span> <span class="s">&quot;s&quot;</span> <span class="o">|</span> <span class="s">&quot;a&quot;</span>
<span class="n">format_spec</span>       <span class="o">::=</span>  <span class="o">&lt;</span><span class="n">described</span> <span class="n">in</span> <span class="n">the</span> <span class="n">next</span> <span class="n">section</span><span class="o">&gt;</span>
</pre></div>


<ul>
<li>
<p>replacement_field必须被包围在"{}"中，任何在"{}"之外的字符串都会被直接输出，如果要输出"{", 必须使用转义“{{”。</p>
</li>
<li>
<p>field_name表示格式化参数的参数名，它可以是字典的key（当参数是一个dictionary），也可以是一个数字。</p>
</li>
<li>
<p>conversion以!开头，表示格式化之前是否需要对参数进行强制转换，它支持三种形式的转换：!s-对参数调用str(), !r-对参数调用repr(),!a对参数调用ascii()</p>
</li>
<li>
<p>format_spec以:开头，表示参数的输出格式，详细定义如下：</p>
<div class="highlight"><pre><span class="n">format_spec</span> <span class="o">::=</span>  <span class="p">[[</span><span class="n">fill</span><span class="p">]</span><span class="n">align</span><span class="p">][</span><span class="n">sign</span><span class="p">][</span><span class="err">#</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">width</span><span class="p">][,][.</span><span class="n">precision</span><span class="p">][</span><span class="n">type</span><span class="p">]</span>
<span class="n">fill</span>        <span class="o">::=</span>  <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">a</span> <span class="n">character</span> <span class="n">other</span> <span class="n">than</span> <span class="sc">&#39;{&#39;</span> <span class="n">or</span> <span class="sc">&#39;}&#39;</span><span class="err">\</span><span class="o">&gt;</span>
<span class="n">align</span>       <span class="o">::=</span>  <span class="s">&quot;&lt;&quot;</span> <span class="o">|</span> <span class="s">&quot;&gt;&quot;</span> <span class="o">|</span> <span class="s">&quot;=&quot;</span> <span class="o">|</span> <span class="s">&quot;^&quot;</span>
<span class="n">sign</span>        <span class="o">::=</span>  <span class="s">&quot;+&quot;</span> <span class="o">|</span> <span class="s">&quot;-&quot;</span> <span class="o">|</span> <span class="s">&quot; &quot;</span>
<span class="n">width</span>       <span class="o">::=</span>  <span class="n">integer</span>
<span class="n">precision</span>   <span class="o">::=</span>  <span class="n">integer</span>
<span class="n">type</span>        <span class="o">::=</span>  <span class="s">&quot;b&quot;</span> <span class="o">|</span> <span class="s">&quot;c&quot;</span> <span class="o">|</span> <span class="s">&quot;d&quot;</span> <span class="o">|</span> <span class="s">&quot;e&quot;</span> <span class="o">|</span> <span class="s">&quot;E&quot;</span> <span class="o">|</span> <span class="s">&quot;f&quot;</span> <span class="o">|</span> <span class="s">&quot;F&quot;</span> <span class="o">|</span> <span class="s">&quot;g&quot;</span> <span class="o">|</span> <span class="s">&quot;G&quot;</span> <span class="o">|</span> <span class="s">&quot;n&quot;</span> <span class="o">|</span> <span class="s">&quot;o&quot;</span> <span class="o">|</span> <span class="s">&quot;s&quot;</span> <span class="o">|</span> <span class="s">&quot;x&quot;</span> <span class="o">|</span> <span class="s">&quot;X&quot;</span> <span class="o">|</span> <span class="s">&quot;%&quot;</span>
</pre></div>


</li>
</ul>
<p>详细的格式化输出例子，请见：http://docs.python.org/3/library/string.html#format-examples</p>
<p>特别留意datetime的输出格式：</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">import</span> <span class="n">datetime</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">58</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="err">&#39;</span><span class="p">{</span><span class="o">:%</span><span class="n">Y</span><span class="o">-%</span><span class="n">m</span><span class="o">-%</span><span class="n">d</span> <span class="o">%</span><span class="n">H</span><span class="o">:%</span><span class="n">M</span><span class="o">:%</span><span class="n">S</span><span class="p">}</span><span class="err">&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="err">&#39;</span><span class="mi">2010</span><span class="o">-</span><span class="mo">07</span><span class="o">-</span><span class="mo">04</span> <span class="mi">12</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">58</span><span class="err">&#39;</span>
</pre></div>


<h2>string.format对比%tuple</h2>
<p>Python官方文档将string.format称为fancier output formatting, 毫无疑问string.format比%tuple花哨很多， 比如：</p>
<p>string.format支持argment的reuse：</p>
<div class="highlight"><pre><span class="n">tu</span> <span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">22222</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">print</span><span class="err">&#39;</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span> <span class="p">{</span><span class="mi">1</span><span class="p">}</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span> <span class="p">{</span><span class="mi">3</span><span class="p">}</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span> <span class="p">{</span><span class="mi">4</span><span class="p">}</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="err">&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">tu</span><span class="p">)</span>
</pre></div>


<p>string.format是一个函数，可以在用作其它函数的参数，从而有更加灵活的用法：</p>
<div class="highlight"><pre><span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">timedelta</span>

<span class="n">once_upon_a_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>  <span class="n">minutes</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">gen</span> <span class="o">=</span><span class="p">(</span><span class="n">once_upon_a_time</span> <span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">delta</span> <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">print</span><span class="sc">&#39;\n&#39;</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="err">&#39;</span><span class="p">{</span><span class="o">:%</span><span class="n">Y</span><span class="o">-%</span><span class="n">m</span><span class="o">-%</span><span class="n">d</span> <span class="o">%</span><span class="n">H</span><span class="o">:%</span><span class="n">M</span><span class="o">:%</span><span class="n">S</span><span class="p">}</span><span class="err">&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">,</span> <span class="n">gen</span><span class="p">))</span>
</pre></div>


<p>以上例子均取自: http://stackoverflow.com/questions/5082452/python-string-formatting-vs-format</p>
<p>Python官方文档建议用string.format替换%tuple方式进行格式化输出，除非你要编写Python2.5及以下版本兼容的代码。</p>
    </div><!-- /.entry-content -->
    
  </article>
</section>
                </div>
                <div class="span2">
                    <section id="sidebar">
                                                <div>
                                <h2>Links</h2>
                                <ul>
                                                                    <li><a href="http://getpelican.com/">Pelican</a></li>
                                                                    <li><a href="http://python.org/">Python.org</a></li>
                                                                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                                                                    <li><a href="http://9pm.me">Diving for fun</a></li>
                                                                </ul>
                            </div><!-- /.Links -->
                                                                    <div>
                                <h2>Social</h2>
                                <ul>
                                    <li><a href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                                                                        <li><a href="http://localhost:8000/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>
                                    
                                                                    <li><a href="http://github.com/tonyzhou">github</a></li>
                                                                </ul>
                            </div><!-- /.social -->
                                        </section><!-- /#sidebar -->
                </div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://twitter.github.com/bootstrap">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="http://localhost:8000/theme/js/bootstrap.min.js"></script>
</body>
</html>